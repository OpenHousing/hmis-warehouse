%section.client__assessments.c-card.c-card--block.c-card--no-padding
  .c-card__header.c-card__header--external
    %h2.section-expander-block__header
      Comprehensive Health Assessments
    - unless @patient.chas.incomplete.exists?
      = link_to polymorphic_path( [:new] + cha_path_generator), class: 'btn btn-secondary btn-sm ml-auto' do
        %i.icon-plus
        Add CHA

  .c-card__content.c-card__content--flush
    - if status = @client.api_status
      - eto_api_path = polymorphic_path(client_path_generator + [:eto_api])
      - if status[:updating]
        .row
          .col-sm-10
            .api-status-status.jApiStatus
              Updating since
              = status[:started_at]
          .col-sm-2.pull-right
            = render 'spinner'
      - else
        .row
          .col-xs-8
            Last updated:
            = status[:updated_at]
          .col-xs-4
            = link_to 'Update', eto_api_path ,method: :patch, class: 'btn btn-sm btn-secondary', data: {confirm: "Updating assessment data can take a few minutes. During this time, assessments for this client won't be available Are you sure you want to proceed?"}

    .row
      .col-md-12
        = render 'chas_table'